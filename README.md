# Libertas Billing System

## 概要

Libertas Billing Systemは、FiveMサーバー向けに設計された、QBCoreフレームワーク専用の包括的な請求書システムです。このシステムにより、プレイヤーはゲーム内で請求書の作成、送信、受信、管理を行うことができます。一般プレイヤーだけでなく、管理者や警察の役割を持つプレイヤー向けの機能も備えています。使いやすいインターフェース、柔軟な設定オプション、堅牢なデータベース構造により、効率的な請求処理を実現します。

### 主な特徴

- **直感的なUI**: 請求書の作成と管理のためのクリーンでレスポンシブなインターフェース。請求書一覧、請求書作成、警察確認の複数タブをサポート。
- **近隣プレイヤー検出**: 設定可能な距離（デフォルト：5メートル）内にいるプレイヤーを自動検出し、請求書作成や未払い請求の確認が可能。
- **柔軟な請求システム**: 1円から100万円までのカスタマイズ可能な金額と、最大500文字の理由を指定して請求書を作成可能。
- **役割ベースのアクセス**: 警察や管理者向けの特別な機能として、近隣プレイヤーの未払い請求を確認可能。
- **通知機能**: 請求書の作成、受信、支払い、期限切れリマインダーに関するリアルタイム通知。
- **カスタマイズ可能な設定**: キー設定、支払い期限、手数料、通知メッセージなどを簡単に調整可能。
- **デバッグモード**: 開発者向けにデバッグモードを搭載し、問題のトラブルシューティングをサポート。
- **データベース最適化**: パフォーマンス向上のためのインデックス付きMySQL/MariaDBデータベース構造。

**注意**: 本システムはQBCoreフレームワークでのみ動作します。他のフレームワーク（ESXなど）には対応していません。

## セットアップ方法

以下の手順に従って、Libertas Billing SystemをFiveMサーバーにインストールおよび設定してください。

### 前提条件
- FiveMサーバーが稼働していること。
- QBCoreフレームワークがインストール済みであること。
- MySQL/MariaDBデータベースが設定済みであること。

### インストール手順

1. **リポジトリのダウンロード**
   - `libertas-billing`リポジトリをダウンロードし、サーバーの`resources`フォルダに解凍します。

2. **データベースの設定**
   - `billing_system.sql`ファイルをサーバーのMySQL/MariaDBデータベースにインポートします。このファイルは、必要なテーブルとインデックスを作成します。
   - 以下のコマンドをデータベースクライアントで実行してください：
     ```sql
     SOURCE /path/to/billing_system.sql;
     ```

3. **リソースの登録**
   - サーバーの`server.cfg`ファイルに以下を追加して、リソースを登録します：
     ```cfg
     ensure libertas-billing
     ```

4. **設定の確認**
   - `config.lua`ファイルを開き、必要に応じて設定をカスタマイズします。主な設定項目：
     - `Config.OpenKey`: 請求書UIを開くキー（デフォルト：F7）
     - `Config.NearbyPlayerDistance`: 近隣プレイヤー検出距離（デフォルト：5メートル）
     - `Config.PaymentDeadline`: 支払い期限（デフォルト：7日）
     - `Config.MaxBillAmount` / `Config.MinBillAmount`: 請求金額の範囲
     - `Config.AdminGroups` / `Config.AdminJobs`: 管理者権限を持つグループや職業
     - `Config.PoliceJobs`: 警察の職業リスト
     - `Config.Notifications`: 通知メッセージのカスタマイズ

5. **サーバーの再起動**
   - サーバーを再起動して、`libertas-billing`リソースをロードします。

6. **動作確認**
   - ゲーム内でF7キー（または設定したキー）を押して、請求書システムのUIが表示されることを確認します。
   - 管理者または警察の役割を持つプレイヤーでログインし、警察タブが表示されることを確認します。
   - 近隣プレイヤーへの請求書作成や未払い請求の確認をテストします。

### 注意事項
- **依存関係**: QBCoreフレームワークが正常に動作している必要があります。
- **データベースの文字セット**: `billing_system`テーブルは`utf8mb4_general_ci`を使用します。データベースの設定が異なる場合は、`billing_system.sql`の最後の行で文字セットを変換してください。
- **パフォーマンス**: 大規模なサーバーでは、インデックスが適切に設定されていることを確認してください（`billing_system.sql`に含まれるインデックスを参照）。

## 使用方法

1. **請求書システムの起動**
   - F7キー（デフォルト）を押して、請求書システムのUIを開きます。
   - 表示されるタブ：
     - **請求書一覧**: 自分の送受信した請求書を確認。
     - **請求書作成**: 近くのプレイヤーに請求書を発行。
     - **未払い確認**（警察/管理者のみ）：近隣プレイヤーの未払い請求を確認。

2. **請求書の作成**
   - 「請求書作成」タブで、5メートル以内のプレイヤーを選択。
   - 金額（1円～100万円）と理由（最大500文字）を入力し、「請求書を送信」をクリック。

3. **請求書の支払い**
   - 「請求書一覧」タブで未払いの請求書を選択し、「支払う」ボタンをクリック。
   - 支払い確認ダイアログで「確認」を選択すると、支払いが処理されます。

4. **警察/管理者機能**
   - 「未払い確認」タブで近隣プレイヤーを選択し、未払い請求書を確認。
   - 未払い請求の詳細（金額、理由、送信者、期限など）が表示されます。

## トラブルシューティング

- **UIが表示されない**
  - `config.lua`の`Config.OpenKey`が他のキーと競合していないか確認してください。
  - サーバーコンソールでエラーログを確認し、`libertas-billing`リソースが正しくロードされているか確認してください。
- **請求書が作成できない**
  - 近隣にプレイヤーがいることを確認してください（`Config.NearbyPlayerDistance`を調整可能）。
  - 金額が`Config.MinBillAmount`以上、`Config.MaxBillAmount`以下であることを確認してください。
- **データベースエラー**
  - `billing_system.sql`が正しくインポートされているか確認してください。
  - データベースの接続設定が正しいことを確認してください。

## ライセンス
このプロジェクトはMITライセンスの下で公開されています。詳細は`LICENSE`ファイルをご覧ください。

## クレジット
- **開発者**: kyuuriGames
- **フレームワーク**: QBCore Framework
- **サポート**: 問題や機能リクエストがある場合は、GitHub Issuesでご連絡ください。
